<!DOCTYPE html>
<html>
  <head />

  <body>
    <div
      id="main"
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
      "
    >
      <canvas id="canvas" width="640" height="640""/>
    </div>

    <script type="module">
      const moduleCode =
        'function t(t,a){return t[Math.floor(a/4)%8]>>a%4&1}function a(a,e=0,l=32){let r=0;for(let n=e;n<l;++n)r=r<<1|t(a,n);return r<0&&(r*=-2),r}function e(t,e){let l=function(t,a,e,l){return function(){var r=(t>>>=0)+(a>>>=0)|0;return t=a^a>>>9,a=(e>>>=0)+(e<<3)|0,e=(e=e<<21|e>>>11)+(r=r+(l=1+(l>>>=0)|0)|0)|0,(r>>>0)/4294967296}}(a(e),a(e),a(e),a(e)),r={t:50,l:"round",h:9,i:4,o:2,M:2,u:6,k:1,v:["black","rgb(254,232,32)","rgb(26, 175, 35)","rgb(198,2,52)","rgb(238,28,11)"],m:t=>t>3&&l()<.99,p:(t,a,e)=>Math.max(2,Math.min(t-e,Math.round(t/Math.pow(1.00111,a))))};!function(t,a,e){let l=e.t,r=t.aspect*l,n=l,o=1/l;function i(t,a){return null==t?a:t}let f=i(e.M,1),h=i(e.h,Math.max(f,n>>3)),s=i(e.k,e.v.length),u=i(e.$,function(t){return t*t}(n/f)),c=i(e.A,10),M=i(e.j,!0),p=i(e.q,!0),d=i(e.C,!1),m=i(e.L,!1),b=i(e.O,!1),v=i(e.S,!1),k="function"==typeof e.v?e.v:(t,a)=>e.v[a];for(var y=new Uint8Array(l*r),g={},U={},P=f;P<=h;++P)g[P]={},U[P]=0;for(var x=0;x<r;++x)for(var S=0;S<l;++S){let t=$(S,x),a=h;if("function"==typeof e.l){let t=e.l(S/l,x/r);a=null==t?0:Math.min(h,Math.max(f,Math.round(t*(h-f+1)+f)))}else"round"==e.l?a=Math.round(Math.min(h,Math.max(0,n/2-Math.hypot(S+.5-n/2,x+.5-n/2)))):"square"==e.l&&(a=Math.min(h,Math.min(S,l-S,x,r-x)));a>=f?(y[t]=a,g[a][t]=!0,U[a]++):y[t]=0}function I(t,a,e){let l=$(t,a),r=y[l];e<r&&(delete g[r][l],U[r]--,e>=f?(y[l]=e,g[e][l]=!0,U[e]++):y[l]=0)}function w(t,a,e){for(var l=t[1]-a-h;l<t[1]+a+h;++l)for(var r=t[0]-a-h;r<t[0]+a+h;++r){let n;if((r<=t[0]?0:1)+(l<=t[1]?0:2)===e){let e=Math.abs(r-t[0]),o=Math.abs(l-t[1]);e<a?n=Math.max(0,o-a):o<a&&(n=Math.max(0,e-a))}else n=Math.min(h,Math.round(Math.max(0,Math.hypot(r-t[0],l-t[1])-a)));I(r,l,n)}}let A=[],C=[],E=[];function R(t,e=6.5,l=1,r=.6){let n,o=2*l,i=Math.min(t/r,2*e);return n=o<i?Math.floor((i-o+1)*Math.pow(a(),.5))+o:o,t/(Math.ceil(n)/2)}function T(t,l=null){for(var r=[],n=0;n<t;++n){let t;null===l?t=Math.floor(a()*s):(t=Math.floor(a()*(e.v.length-1)),t===l&&(t=e.v.length-1)),r.push(t),l=t}return r}function $(t,a){let e,n;return void 0===a?(e=t[0],n=t[1]):(e=t,n=a),(e+l)%l+(n+r)%r*l}function F(t,a){return t[0]>=0&&t[1]>=0&&t[0]<l&&t[1]<r&&y[$(t)]>=a}function j(t,l,r,n,o,i=T(1)[0],f){C.push({U:t,_:r,B:n,D:o,back:i});let s=null==f?a()<r/h&&a()>.3?r/(5+2*Math.floor(2*a()))*2:R(r):f,u=r-s,c=(r-(1+Math.floor(a()*r/10))-u)/2,M=2*u/3,p=Math.min(c,M);if(u>=e.M&&p>=1&&(null==f||f<=1.05*r))j(t,[t[0]+(o?-1:1)*(u+p),t[1]-u-p],u,p,o,T(1,i)[0],s);else if(null==f){if(s=Math.min(s,R(r)),s>=1)A.push({U:t,rad:r-s,inner:T(Math.ceil(r/s-1),i),F:s});else if(r>=1){let e=Math.max(1,Math.round(a()*(r-1)*2/3));A.push({U:t,rad:e,inner:T(1,i)})}}else u>=1&&A.push({U:t,rad:u,inner:T(1,i)});let d=Math.max(R(n,r/s));d>1&&A.push({U:l,rad:n-d,inner:T(Math.ceil(n/d-1),i),F:d})}for(let t=0;t<u;++t){let r={},n=0,o=null;for(let t=h;t>=f;t--)n+=U[t],0!=n&&(null==o&&(o=t),r[t]=n);if(o<e.o)break;if(e.p(o,t,0)<f)break;let i=null;for(let f=0;;++f){let h=Math.min(o,e.p(o,t,f));if(h<e.o)break;let s,M=h;if(e.m(t))s=Math.floor(a()*U[h]);else for(s=Math.floor(a()*r[h]);s>=U[M];)s-=U[M],M++;let p=Object.keys(g[M])[s],d=[p%l,Math.floor(p/l)];i=i||{U:[d[0],d[1]],rad:h};let m=Math.min(Math.floor(2*h/3),e.i);if(0==n[m])break;var q=null,B=null;let b=Math.max(e.M,h/5);for(var D=b;D<=m;++D){let t=[d[0]-h-D,d[1]-h-D];if(!F(t,D))break;q=D,B=t}for(D=q?q+Math.floor(2*a()):b;D<=m;++D){let t=[d[0]+h+D,d[1]-h-D];if(!F(t,D))break;q=D,B=t}if(null!==B){let t=B[0]<d[0];w(d,h+2,t?0:1),w(B,q+2,t?3:2),j(d,B,h,q,t);break}if(f>c){i.rad<=e.u&&(t==u-1&&e.C?E.push(i):(w(i.U,i.rad+2),A.push({U:i.U,rad:i.rad,inner:T(R(i.rad))})));break}}}if(Array.isArray(v)&&2==v.length){let a=t.createLinearGradient(0,0,0,1);a.addColorStop(0,v[0]),a.addColorStop(1,v[1]),t.fillStyle=a,t.fillRect(0,0,1,t.aspect)}else"string"==typeof v&&(t.fillStyle=v,t.fillRect(0,0,1,t.aspect));if(b)for(let a=0;a<r;++a)for(let e=0;e<l;++e){let r=y[$(e,a)];if(r>0){let n=(r-f)/(h-f+1),i=96+64*(1-r%2),s=96+r%2*64;t.fillStyle=`rgba(${(r-f)%8*32}, ${s*(1-n)}, ${i*(1-n)}, 0.75)`,t.fillRect(e/l,a/l,o,o)}}function L(a,e,n,o,i,f){void 0===f&&(a[0]<2*(e+n)&&(t.translate(1,0),L(a,e,n,o,i,!0),t.translate(-1,0)),a[0]>l-2*(e+n)&&(t.translate(-1,0),L(a,e,n,o,i,!0),t.translate(1,0)),a[1]>0&&a[1]<2*(e+n)&&(t.translate(0,t.aspect),L(a,e,n,o,i,!0),t.translate(0,-t.aspect)),a[1]<r&&a[1]>r-2*(e+n)&&(t.translate(0,-t.aspect),L(a,e,n,o,i,!0),t.translate(0,t.aspect)));let h=(a[0]+.5)/l,s=(a[1]+.5)/l,u=e/l,c=n/l,M=Math.min(u,c);t.fillStyle=k([h,s],i),t.save(),t.beginPath(),t.translate(h,s),o&&t.scale(-1,1),t.arc(0,0,u,0,3*Math.PI/2),t.arc(u-M,-u-M,M,Math.PI/2,2*Math.PI,!0),t.arc(u+c,-u-c,c,Math.PI,Math.PI/2,!1),t.arc(u+M,M-u,M,3*Math.PI/2,Math.PI,!0),t.fill(),t.restore()}function O(a,e,n,o=e/n.length,i){void 0===i&&(a[0]<2*e&&(t.translate(1,0),O(a,e,n,o,!0),t.translate(-1,0)),a[0]>l-2*e&&(t.translate(-1,0),O(a,e,n,o,!0),t.translate(1,0)),a[1]>0&&a[1]<2*e&&(t.translate(0,t.aspect),O(a,e,n,o,!0),t.translate(0,-t.aspect)),a[1]<r&&a[1]>r-2*e&&(t.translate(0,-t.aspect),O(a,e,n,o,!0),t.translate(0,t.aspect)));let f=(a[0]+.5)/l,h=(a[1]+.5)/l,s=e/l,u=o/l;n.forEach((a=>{t.fillStyle=k([f,h],a),t.beginPath(),t.arc(f,h,s,0,2*Math.PI),s-=u,t.fill()}))}if(M&&C.forEach((({U:t,_:a,B:e,D:l,back:r})=>L(t,a,e,l,r))),p&&A.forEach((({U:t,rad:a,inner:e,F:l})=>O(t,a,e,l))),d&&E.forEach((({U:a,rad:e})=>function(a,e,n){let i=(a[0]+.5)/l,f=(a[1]+.5)/l,h=e/l;t.lineWidth=.2/l,t.strokeStyle=style||"black",t.beginPath(),t.arc(i,f,h,0,10),t.stroke(),t.strokeRect(col/l,row/r,o,o)}(a,e))),m){t.strokeStyle="#0005",t.lineWidth=7e-4,t.beginPath();for(let a=0;a<r;++a)t.moveTo(0,a/r*t.aspect),t.lineTo(1,a/r*t.aspect);for(let a=0;a<l;++a)t.moveTo(a/l,0),t.lineTo(a/l,t.aspect);t.stroke()}}(t,l,r)}export{e as draw};';
      const blob = new Blob([moduleCode], { type: "application/javascript" });
      const moduleUrl = URL.createObjectURL(blob);

      const useModuleScript = document.createElement("script");
      useModuleScript.type = "module";
      useModuleScript.textContent = `
        import { draw } from '${moduleUrl}';

        const canvas = document.getElementById("canvas");
        const width = canvas.width;
        const height = canvas.height;

        const ctx = canvas.getContext("2d");

        ctx.scale(width, height);
        ctx.aspect = width / height;

        const seed = [0,1,2,3,4,5,6,7]
        draw(ctx, seed);
        ctx.restore();
      `;

      document.head.appendChild(useModuleScript);
    </script>
  </body>
</html>
